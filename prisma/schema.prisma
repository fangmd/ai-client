// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider     = "prisma-client-js"
  relationMode = "prisma"
}

datasource db {
  provider = "sqlite"
}

model AiProvider {
  id           BigInt   @id
  name         String? // 提供商名称（可选，用于标识）
  provider     String // 提供商类型: openai, anthropic, custom
  apiKey       String // API 密钥
  baseURL      String? // 基础 URL（可选）
  model        String // 模型名称
  temperature  Float? // 温度参数（可选）
  maxTokens    Int? // 最大 token 数（可选）
  organization String? // OpenAI 组织 ID（可选）
  isDefault    Boolean  @default(false) // 是否默认提供商
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([provider])
  @@index([isDefault])
  @@map("ai_provider")
}

model ChatSession {
  id           BigInt   @id
  title        String // 对话标题
  aiProviderId BigInt // 关联的 AI Provider ID（逻辑外键，必填）
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([aiProviderId])
  @@index([createdAt])
  @@index([updatedAt])
  @@map("chat_session")
}

model Message {
  id          BigInt   @id
  sessionId   BigInt // 所属会话 ID（逻辑外键）
  role        String // 角色: user, assistant, system
  content     String // 消息内容
  status      String? // 状态: sent(已发送), pending(发送中), error(错误)
  totalTokens Int? // Token 总数（可选）
  createdAt   DateTime @default(now())

  @@index([sessionId])
  @@index([createdAt])
  @@map("message")
}
