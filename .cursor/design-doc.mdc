---
description: 设计方案文档编写规范，定义功能设计文档的结构、命名、内容要求等标准，确保设计文档的一致性和完整性
globs: 
alwaysApply: false
---
# 设计方案文档编写规范

## 文档位置和命名

### 文件位置
- 所有设计方案文档存放在 `doc/` 目录下

### 文件命名
- 格式：`序号.功能名_DESIGN.md`
- 序号：两位数字，从 00 开始递增
- 功能名：使用大写字母和下划线分隔
- 示例：
  - `00.AI_CHAT_DESIGN.md`
  - `01.CHAT_SESSION_MANAGEMENT_DESIGN.md`
  - `02.APP_CONFIG_DESIGN.md`

## 文档结构

### 标准章节顺序

设计文档应包含以下章节，根据功能复杂度可适当增减：

```
# 功能名称设计方案

## 一、概述
## 二、数据库设计（如涉及）
## 三、架构设计
## 四、目录结构
## 五、核心接口设计
## 六、IPC 通道定义
## 七、Repository 层设计
## 八、前端 Store/组件设计
## 九、实现步骤
## 十、注意事项
## 十一、扩展功能（未来）
## 十二、技术细节（可选）
```

### 章节说明

#### 一、概述
- 简要描述功能目标和范围
- 说明核心功能点
- 说明技术选型

#### 二、数据库设计（如涉及）
- 使用 Prisma Schema 格式定义数据模型
- 说明字段含义和约束
- 说明索引设计
- 说明外键关系（逻辑外键 vs 物理外键）

#### 三、架构设计
- **必须包含 ASCII 架构图**，展示分层结构
- 说明各层职责
- 说明使用的设计模式

#### 四、目录结构
- 使用树形结构展示文件组织
- 标注每个文件的用途

#### 五、核心接口设计
- 使用 TypeScript 接口定义
- 说明接口用途和参数含义

#### 六、IPC 通道定义
- 列出所有 IPC 通道常量
- 定义请求和响应类型

#### 七、Repository 层设计
- 定义数据访问函数签名
- 说明函数用途

#### 八、前端 Store/组件设计
- 定义 Zustand Store 接口
- 定义组件 Props
- 说明状态管理策略

#### 九、实现步骤
- 分阶段列出实现步骤
- 使用 checkbox 标记完成状态
- 示例：
  ```markdown
  ### 阶段一：数据库设计
  1. ✅ 设计方案（当前步骤）
  2. 更新 Prisma Schema
  3. 创建数据库迁移
  ```

#### 十、注意事项
- 安全性考虑
- 性能优化建议
- 错误处理策略
- 代码质量要求

#### 十一、扩展功能（未来）
- 列出计划但暂不实现的功能
- 为未来扩展预留设计空间

## 必须包含的元素

### 1. ASCII 架构图
展示分层架构，格式示例：
```
┌─────────────────────────────────────────┐
│      Renderer 层 (UI)                   │
│  - 组件名                               │
│  - Store (Zustand)                      │
└──────────────┬──────────────────────────┘
               │ IPC 通信
┌──────────────▼──────────────────────────┐
│      IPC 层 (通信桥梁)                   │
│  - IPC_CHANNELS.xxx.*                   │
│  - IPC 类型定义                          │
└──────────────┬──────────────────────────┘
               │ IPC 调用
┌──────────────▼──────────────────────────┐
│      Main Handler 层                    │
│  - XxxHandler                           │
│  - 请求路由和分发                        │
└──────────────┬──────────────────────────┘
               │ 调用
┌──────────────▼──────────────────────────┐
│      Repository 层                       │
│  - xxx.ts                               │
│  - 数据访问和业务逻辑                     │
└──────────────┬──────────────────────────┘
               │ Prisma ORM
┌──────────────▼──────────────────────────┐
│      Database 层 (SQLite)               │
└─────────────────────────────────────────┘
```

### 2. Prisma Schema（如涉及数据库）
```prisma
model Example {
  id        BigInt   @id
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@map("example")
}
```

### 3. TypeScript 接口定义
```typescript
interface ExampleIPC {
  create: {
    request: { name: string }
    response: IPCResponse<Example>
  }
  list: {
    request: { limit?: number }
    response: IPCResponse<Example[]>
  }
}
```

### 4. IPC 通道定义
```typescript
export const IPC_CHANNELS = {
  example: {
    create: 'example:create',
    list: 'example:list',
    get: 'example:get',
    update: 'example:update',
    delete: 'example:delete'
  }
} as const
```

### 5. 目录结构
```
src/
├── main/
│   ├── handlers/
│   │   └── example-handler.ts    # IPC Handler
│   └── repository/
│       └── example.ts            # Repository
├── common/
│   └── constants/
│       └── ipc.ts                # IPC 通道常量
└── types/
    └── example-type.ts           # 类型定义
```

### 6. 实现流程图（可选）
使用序号和箭头描述流程：
```
1. 用户在 UI 触发操作
   ↓
2. Renderer 调用 IPC
   ↓
3. Handler 处理请求
   ↓
4. Repository 访问数据库
   ↓
5. 返回结果并更新 UI
```

## 设计原则

### 1. 分层架构
- **Renderer 层**：UI 组件和状态管理
- **IPC 层**：进程间通信桥梁
- **Main Handler 层**：请求处理和路由
- **Repository 层**：数据访问封装
- **Database 层**：数据持久化

### 2. 设计模式
设计文档中应说明使用的设计模式：
- **Repository 模式**：封装数据访问逻辑
- **Handler 模式**：统一处理 IPC 请求
- **Store 模式**：前端状态管理（Zustand）
- **策略模式**：可选，用于多实现切换
- **工厂模式**：可选，用于创建实例

### 3. 最小化修改原则
- 优先扩展而非修改现有代码
- 新功能应独立成模块
- 避免修改不相关的模块

### 4. 类型安全
- 所有接口必须有 TypeScript 类型定义
- IPC 请求和响应必须定义类型
- 使用 `IPCResponse<T>` 统一响应格式

## 编写技巧

### 暂不实现的功能
使用以下格式标记暂不实现的功能：
```markdown
#### X.X.X 功能名

**状态**：⚠️ 暂时不做

**功能**：功能描述（未来功能）

**说明**：该功能将在后续版本中实现，当前版本暂不支持。
```

### 接口预留
对于暂不实现但需要预留的接口：
```markdown
**接口定义**（预留，暂不实现）：
```typescript
// 预留接口代码
```
```

### 字段说明
重要字段需添加注释说明：
```typescript
interface Example {
  id: bigint           // 主键 ID（Snowflake ID）
  name: string         // 名称
  status?: string      // 状态: active(活跃), inactive(非活跃)
  createdAt: Date      // 创建时间
}
```

## 文档维护

### 状态更新
实现完成后更新实现步骤的状态：
- `1. ✅ 已完成的步骤`
- `2. 待完成的步骤`

### 版本记录
重大设计变更应在文档开头或结尾记录：
```markdown
## 变更记录

| 日期 | 变更内容 | 原因 |
|------|----------|------|
| 2024-01-01 | 添加 xxx 字段 | 支持 yyy 功能 |
```

## 禁止事项

- ❌ 禁止使用非标准章节结构（保持文档一致性）
- ❌ 禁止省略架构图（必须包含 ASCII 架构图）
- ❌ 禁止省略类型定义（所有接口必须有 TypeScript 类型）
- ❌ 禁止硬编码 IPC 通道名称（必须使用常量）
- ❌ 禁止在文档中包含实现代码（设计文档只包含接口和结构定义）
- ❌ 禁止省略实现步骤（必须列出分阶段实现计划）
- ❌ 禁止省略注意事项（必须说明安全性、性能、错误处理等考虑）
